# 디스코드 스케줄 신청 봇

매월 20일 오전 9시에 자동으로 스케줄 신청 안내 메시지를 게시하고, 댓글 응답을 자동 처리하는 디스코드 봇입니다.

## 주요 기능

- 📅 **자동 월간 게시**: 매월 20일 오전 9시에 스케줄 신청 안내 메시지 자동 전송
- 💬 **댓글 자동 응답**: 스케줄 신청 메시지에 댓글이 달리면 자동으로 "신청 완료" 응답
- 🎯 **다중 채널 지원**: 여러 채널에 동시 메시지 예약 가능
- 🌍 **한국 시간대 지원**: Asia/Seoul 시간대로 정확한 스케줄링
- 🛠️ **간편한 설정**: JSON 기반 구성 파일로 메시지 커스터마이징
- 📊 **상태 확인 명령어**: 봇 상태 및 예정된 메시지 확인
- 🧪 **테스트 기능**: 설정 확인을 위한 테스트 메시지 전송
- 📝 **상세한 로깅**: 봇 활동 모니터링
- 📋 **스케줄 업로드**: 관리자가 DM으로 스케줄 이미지를 업로드하면 자동으로 공지

## 빠른 시작

### 1. 사전 요구사항

- Python 3.11 이상
- 디스코드 애플리케이션 및 봇 토큰
- 디스코드 개발자 포털에서 다음 권한 활성화:
  - MESSAGE CONTENT INTENT
  - Server Members Intent (선택사항)

### 2. 설치

```bash
# 프로젝트 클론
git clone <repository-url>
cd ScheduledPoster

# 의존성 설치 (uv 사용)
uv sync

# 또는 pip 사용
pip install -r requirements.txt
```

### 3. 환경 설정

1. `.env` 파일 생성:
```env
DISCORD_BOT_TOKEN=your_discord_bot_token_here
```

2. `config/config.json` 파일 수정:
```json
{
    "command_prefix": "!",
    "timezone": "Asia/Seoul",
    "scheduled_channels": [
        {
            "channel_id": YOUR_CHANNEL_ID,
            "message": "커스텀 메시지 내용",
            "description": "채널 설명"
        }
    ],
    "admin_ids": [YOUR_ADMIN_USER_ID]
}
```

### 4. 봇 실행

```bash
python main.py
```

## 사용법

### 기본 명령어

| 명령어 | 설명 | 권한 |
|--------|------|------|
| `!help` / `!도움말` | 도움말 표시 | 모든 사용자 |
| `!status` | 봇 상태 및 다음 예약 메시지 확인 | 모든 사용자 |
| `!channels` | 설정된 채널 목록 표시 | 모든 사용자 |
| `!test [채널ID]` | 테스트 메시지 전송 | 메시지 관리 권한 |
| `!demo` | 봇 기능 데모 | 모든 사용자 |

### 슬래시 명령어

| 명령어 | 설명 | 권한 |
|--------|------|------|
| `/데모` | 봇 기능 데모 | 모든 사용자 |
| `/상태` | 봇 상태 확인 | 모든 사용자 |
| `/채널목록` | 설정된 채널 목록 | 모든 사용자 |
| `/테스트 [채널ID]` | 테스트 메시지 전송 | 메시지 관리 권한 |
| `/명령어` | 사용 가능한 명령어 목록 | 모든 사용자 |
| `/공지` | **공지사항 작성 (모달 입력)** | 메시지 관리 권한 |
| `/신청현황` | **신청 현황 요약 (DM으로만 전송)** | 관리자 |
| `/통계` | **신청 통계 리포트 (DM으로만 전송)** | 관리자 |

> **참고:**
> - `/신청현황`, `/통계` 슬래시 명령어도 결과가 **항상 관리자 DM(개인 메시지)로만 전송**됩니다.
> - DM이 차단되어 있으면 안내 메시지가 출력됩니다.

> **공지사항 기능:**
> - `/공지` 입력 시 모달 창이 열립니다
> - 제목과 내용을 입력하면 자동으로 "자료실" 채널에 업로드됩니다
> - 임베드 형태로 깔끔하게 포맷팅됩니다

### 관리자 명령어

| 명령어 | 설명 | 권한 |
|--------|------|------|
| `!add_channel <채널ID> [메시지]` | 예약 채널 추가 | 관리자 |
| `!remove_channel <채널ID>` | 예약 채널 삭제 | 관리자 |
| `!set_message <채널ID> <메시지>` | 채널별 메시지 수정 | 관리자 |
| `!sendlog [개수]` | 최근 발송 내역 조회 | 관리자 |
| `!신청현황` | **신청 현황 요약 (DM으로만 전송)** | 관리자 |
| `!통계` | **신청 통계 리포트 (DM으로만 전송)** | 관리자 |

> **참고:**
> - `!신청현황`, `!통계` 명령어는 서버 채널에서 입력해도 결과가 **항상 관리자 DM(개인 메시지)로만 전송**됩니다.
> - DM이 차단되어 있으면 안내 메시지가 출력됩니다.

### 스케줄 업로드 기능

관리자는 봇에게 DM으로 다음을 전송할 수 있습니다:
1. 스케줄 이미지 파일 첨부
2. 메시지 내용에 `!스케쥴업로드` 입력
3. 몇 월 스케줄인지 숫자로 응답 (예: 7)
4. 자동으로 서버의 "스케쥴" 채널에 공지 메시지 업로드

## 설정 파일

### config/config.json

```json
{
    "command_prefix": "!",
    "timezone": "Asia/Seoul",
    "default_message": "기본 스케줄 신청 메시지",
    "scheduled_channels": [
        {
            "channel_id": 123456789,
            "message": "채널별 커스텀 메시지",
            "description": "채널 설명"
        }
    ],
    "admin_ids": [123456789],
    "log_file": "config/send_log.json"
}
```

### 환경 변수 (.env)

```env
DISCORD_BOT_TOKEN=your_discord_bot_token_here
```

## 프로젝트 구조

```
ScheduledPoster/
├── bot/
│   ├── commands.py      # 봇 명령어 구현
│   ├── discord_bot.py   # 메인 봇 클래스
│   └── scheduler.py     # 메시지 스케줄링
├── config/
│   ├── config.json      # 봇 설정
│   └── settings.py      # 설정 관리
├── utils/
│   └── logger.py        # 로깅 설정
├── main.py              # 봇 실행 진입점
├── pyproject.toml       # 프로젝트 의존성
└── README.md           # 프로젝트 문서
```

## 의존성

- `discord.py` >= 2.5.2 - 디스코드 봇 API
- `apscheduler` >= 3.11.0 - 작업 스케줄링
- `python-dotenv` >= 1.1.0 - 환경 변수 관리
- `pytz` >= 2025.2 - 시간대 처리

## 로깅

봇은 다음 위치에 로그를 생성합니다:
- 콘솔 출력: 실시간 봇 상태
- `config/send_log.json`: 메시지 발송 내역

## 문제 해결

### 일반적인 문제

1. **봇이 메시지를 보내지 않음**
   - 채널 ID가 올바른지 확인
   - 봇이 해당 채널에 접근 권한이 있는지 확인

2. **명령어가 작동하지 않음**
   - 봇이 서버에 있는지 확인
   - 필요한 권한이 부여되었는지 확인

3. **시간대 문제**
   - `config.json`의 `timezone` 설정 확인
   - 서버 시간대와 일치하는지 확인

자세한 문제 해결 방법은 `troubleshooting.md`를 참조하세요.

## 라이선스

이 프로젝트는 MIT 라이선스 하에 배포됩니다.

## 기여

버그 리포트나 기능 제안은 이슈를 통해 제출해주세요.
